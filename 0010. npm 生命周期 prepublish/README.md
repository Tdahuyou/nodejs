# [0010. npm ç”Ÿå‘½å‘¨æœŸ prepublish](https://github.com/Tdahuyou/nodejs/tree/main/0010.%20npm%20%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%20prepublish)

æ–°å»ºä¸€ä¸ª [1.js](./1.js) æ¨¡å—ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```js
console.log('call 1.js')
```

æ–°å»ºä¸€ä¸ª [package.json](./package.json) æ¨¡å—ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```json
{
  "name": "demo",
  "version": "1.0.0",
  "scripts": {
    "prepublish": "node 1.js"
  },
  "dependencies": {
    "lodash": "^4.17.21"
  }
}
```

æ‰§è¡Œ `npm i` å®‰è£…ä¾èµ–ã€‚ï¼ˆå¦‚æœå­˜åœ¨ node_modulesï¼Œå°†å…¶åˆ é™¤åå†æ‰§è¡Œ npm iï¼‰

ä¼šå‘ç° prepublish ä¸­é…ç½®çš„å‘½ä»¤ `node 1.js` è‡ªåŠ¨æ‰§è¡Œäº†ï¼Œ`1.js` æ‰§è¡Œåè¾“å‡ºäº† `call 1.js`ã€‚

![](md-imgs/2024-09-20-15-19-24.png)

# ğŸ¤– AI

## ğŸ¤– è¯·ä»‹ç»ä¸€ä¸‹ package.json ä¸­çš„ scripts å­—æ®µä¸‹çš„ prepublish

åœ¨ `package.json` æ–‡ä»¶ä¸­ï¼Œ`scripts` å­—æ®µå…è®¸ä½ å®šä¹‰å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­é€šè¿‡ `npm run <script-name>` æ‰§è¡Œçš„è„šæœ¬ã€‚è¿™äº›è„šæœ¬å¯ä»¥æ˜¯ä»»ä½• shell å‘½ä»¤ï¼Œé€šå¸¸ç”¨äºè‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²ç­‰ä»»åŠ¡ã€‚

`prepublish` æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ npm ç”Ÿå‘½å‘¨æœŸè„šæœ¬ï¼Œå®ƒåœ¨ä½ è¿è¡Œ `npm publish` ä¹‹å‰è‡ªåŠ¨æ‰§è¡Œã€‚è¿™ä¸ªè„šæœ¬å¯ä»¥ç”¨æ¥æ‰§è¡Œä¸€äº›å‘å¸ƒå‰çš„å‡†å¤‡å·¥ä½œï¼Œæ¯”å¦‚ç¼–è¯‘ä»£ç ã€è¿è¡Œæµ‹è¯•ã€æ›´æ–°ç‰ˆæœ¬å·ç­‰ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`prepublish` è„šæœ¬çš„è¡Œä¸ºåœ¨ npm çš„ä¸åŒç‰ˆæœ¬ä¸­æœ‰è¿‡å˜åŒ–ï¼š

- **npm 5.0.0 åŠä¹‹å**ï¼š`prepublish` è„šæœ¬ä¼šè¢«å½“ä½œ `prepare` è„šæœ¬æ¥å¤„ç†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ä½ å®‰è£…ä¸€ä¸ªåŒ…ï¼ˆæ— è®ºæ˜¯æœ¬åœ°å¼€å‘è¿˜æ˜¯ä½œä¸ºä¾èµ–ï¼‰æ—¶ï¼Œ`prepublish` ä¹Ÿä¼šè¢«è¿è¡Œã€‚å¦‚æœä½ åªæƒ³åœ¨å‘å¸ƒå‰è¿è¡ŒæŸäº›è„šæœ¬ï¼Œåº”è¯¥ä½¿ç”¨ `prepublishOnly`ã€‚
- **npm 4.0.0 åŠä¹‹å‰**ï¼š`prepublish` åœ¨ `npm publish` ä¹‹å‰è¿è¡Œï¼Œå¹¶ä¸”ä¸ä¼šåœ¨å®‰è£…æ—¶è¿è¡Œã€‚

### ä½¿ç”¨ `prepublishOnly`

ä¸ºäº†ç¡®ä¿ä½ çš„å‡†å¤‡è„šæœ¬åªåœ¨å‘å¸ƒå‰è¿è¡Œï¼Œä½ åº”è¯¥ä½¿ç”¨ `prepublishOnly` è€Œä¸æ˜¯ `prepublish`ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ `package.json` ä¸­çš„ `scripts` å­—æ®µé…ç½®ï¼š

```json
{
  "name": "your-package",
  "version": "1.0.0",
  "scripts": {
    "build": "webpack --config webpack.config.js",
    "test": "jest",
    "prepublishOnly": "npm run build && npm run test"
  }
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š
- `build` è„šæœ¬ç”¨äºç¼–è¯‘æºä»£ç ã€‚
- `test` è„šæœ¬ç”¨äºè¿è¡Œæµ‹è¯•ã€‚
- `prepublishOnly` è„šæœ¬ä¼šåœ¨ `npm publish` ä¹‹å‰æ‰§è¡Œï¼Œå®ƒé¦–å…ˆè°ƒç”¨ `build` è„šæœ¬æ¥ç¼–è¯‘ä»£ç ï¼Œç„¶åè°ƒç”¨ `test` è„šæœ¬æ¥ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ã€‚

### æ³¨æ„äº‹é¡¹

- å¦‚æœä½ åœ¨ `prepublishOnly` ä¸­æœ‰è€—æ—¶è¾ƒé•¿çš„æ“ä½œï¼ˆå¦‚ç¼–è¯‘å¤§å‹é¡¹ç›®ï¼‰ï¼Œè¯·ç¡®ä¿è¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºè¿™å°†å½±å“å‘å¸ƒæµç¨‹çš„æ—¶é—´ã€‚
- ç¡®ä¿ `prepublishOnly` è„šæœ¬èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†é”™è¯¯å¹¶ç»™å‡ºæ˜ç¡®çš„åé¦ˆï¼Œè¿™æ ·åœ¨å‘å¸ƒè¿‡ç¨‹ä¸­å¦‚æœå‡ºç°é—®é¢˜ï¼Œä½ å¯ä»¥å¿«é€Ÿå®šä½å’Œä¿®å¤ã€‚
- å¦‚æœä½ å¸Œæœ›åœ¨å®‰è£…æ—¶ä¹Ÿæ‰§è¡ŒæŸäº›å‡†å¤‡æ­¥éª¤ï¼ˆä¾‹å¦‚ç¼–è¯‘ TypeScript ä»£ç åˆ° JavaScriptï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ `prepare` è„šæœ¬ã€‚

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥ç¡®ä¿æ¯æ¬¡å‘å¸ƒæ—¶éƒ½æœ‰ä¸€è‡´çš„æ„å»ºè¿‡ç¨‹ï¼Œä»è€Œæé«˜å‘å¸ƒçš„å¯é æ€§å’Œä»£ç çš„è´¨é‡ã€‚